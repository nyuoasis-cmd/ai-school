# 🗄️ MoodCare (마음돌봄) — 데이터 구조 및 로직

---

## 1. 대상자 데이터 (clients)

```javascript
const clients = [
  {
    id: 1,
    name: '김순자',
    age: 78,
    gender: '여',
    condition: '경도 치매',
    mood: 'sad',
    moodLabel: '슬픔',
    moodFace: '😢',
    alert: true,
    avatarInitial: '김',
    avatarColor: '#E57373',
    sparkline: [65, 58, 52, 48, 42, 55, 40]   // 최근 7일 종합점수 (0~100)
  },
  {
    id: 2,
    name: '이영호',
    age: 82,
    gender: '남',
    condition: '우울증',
    mood: 'lonely',
    moodLabel: '외로움',
    moodFace: '🫤',
    alert: true,
    avatarInitial: '이',
    avatarColor: '#7986CB',
    sparkline: [45, 50, 42, 38, 45, 40, 35]
  },
  {
    id: 3,
    name: '박옥순',
    age: 75,
    gender: '여',
    condition: '관절염',
    mood: 'calm',
    moodLabel: '평온',
    moodFace: '😌',
    alert: false,
    avatarInitial: '박',
    avatarColor: '#81C784',
    sparkline: [70, 72, 68, 75, 78, 80, 76]
  },
  {
    id: 4,
    name: '정대현',
    age: 80,
    gender: '남',
    condition: '당뇨',
    mood: 'happy',
    moodLabel: '기쁨',
    moodFace: '😊',
    alert: false,
    avatarInitial: '정',
    avatarColor: '#4DB6AC',
    sparkline: [75, 78, 82, 80, 85, 83, 88]
  },
  {
    id: 5,
    name: '한미경',
    age: 77,
    gender: '여',
    condition: '고혈압',
    mood: 'calm',
    moodLabel: '평온',
    moodFace: '😌',
    alert: false,
    avatarInitial: '한',
    avatarColor: '#FF8A65',
    sparkline: [68, 65, 70, 72, 70, 74, 72]
  },
  {
    id: 6,
    name: '최병수',
    age: 85,
    gender: '남',
    condition: '파킨슨',
    mood: 'anxious',
    moodLabel: '불안',
    moodFace: '😰',
    alert: false,
    avatarInitial: '최',
    avatarColor: '#9575CD',
    sparkline: [55, 58, 52, 50, 48, 52, 55]
  }
];
```

---

## 2. 감정 축 정의 (emotions)

```javascript
const emotions = [
  { key: 'happy',   name: '기쁨',   emoji: '😊', color: '#10B981' },  // green
  { key: 'calm',    name: '평온',   emoji: '😌', color: '#0D9488' },  // teal
  { key: 'sad',     name: '슬픔',   emoji: '😢', color: '#3B82F6' },  // blue
  { key: 'anxious', name: '불안',   emoji: '😰', color: '#F59E0B' },  // amber
  { key: 'angry',   name: '분노',   emoji: '😠', color: '#F97066' },  // coral
  { key: 'lonely',  name: '외로움', emoji: '🫤', color: '#7C3AED' },  // lavender
];
```

---

## 3. 분석 결과 데이터 (sampleResults)

각 대상자별 미리 정의된 분석 결과:

```javascript
const sampleResults = {
  1: {  // 김순자
    scores: { happy: 15, calm: 20, sad: 72, anxious: 45, angry: 10, lonely: 65 },
    risk: 'high',
    riskText: '심리 상태 주의 필요',
    riskDesc: '슬픔과 외로움 지수가 매우 높습니다. 자녀와의 분리감이 주요 원인으로 보이며, 우울 증세가 심화될 가능성이 있습니다.',
    recs: [
      '🎵 음악치료 프로그램 참여 권유',
      '📞 자녀와 정기 영상통화 스케줄 설정',
      '👥 또래 그룹 활동 참여 유도',
      '📋 주치의 상담 일정 확인'
    ]
  },
  2: {  // 이영호
    scores: { happy: 20, calm: 25, sad: 55, anxious: 40, angry: 15, lonely: 78 },
    risk: 'high',
    riskText: '외로움 수치 경고',
    riskDesc: '외로움 지수가 78로 매우 높습니다. 사회적 고립감이 심화되고 있으며, 적극적인 사회 활동 프로그램 참여가 필요합니다.',
    recs: [
      '👥 주간보호센터 프로그램 확대',
      '🎯 취미 활동 그룹 매칭',
      '📞 일 1회 안부 전화 설정',
      '🏥 정신건강의학과 정기 상담'
    ]
  },
  3: {  // 박옥순
    scores: { happy: 55, calm: 78, sad: 20, anxious: 15, angry: 8, lonely: 18 },
    risk: 'low',
    riskText: '안정적',
    riskDesc: '전반적으로 안정된 심리 상태입니다. 평온함과 기쁨 지수가 높아 현재 돌봄 환경에 잘 적응하고 있습니다.',
    recs: [
      '✅ 현재 돌봄 패턴 유지',
      '🌿 야외 활동 기회 확대',
      '📖 독서/원예 등 취미 활동 지속',
      '💊 기존 약물 복용 스케줄 유지'
    ]
  },
  4: {  // 정대현
    scores: { happy: 82, calm: 70, sad: 10, anxious: 12, angry: 5, lonely: 15 },
    risk: 'low',
    riskText: '매우 안정',
    riskDesc: '매우 긍정적인 심리 상태입니다. 기쁨 지수가 높고 부정 감정이 낮아 현재 생활에 만족감을 느끼고 계십니다.',
    recs: [
      '✅ 현재 돌봄 프로그램 유지',
      '🎉 사회 활동 리더 역할 부여',
      '📝 긍정 일기 쓰기 권장',
      '🤝 또래 멘토링 활동 참여'
    ]
  },
  5: {  // 한미경
    scores: { happy: 50, calm: 72, sad: 22, anxious: 28, angry: 12, lonely: 25 },
    risk: 'low',
    riskText: '안정적',
    riskDesc: '평온한 심리 상태를 유지하고 있습니다. 약간의 불안감이 있으나 정상 범위 내입니다.',
    recs: [
      '🧘 이완 요법/명상 프로그램',
      '🚶 규칙적 산책 유지',
      '📞 가족 연락 빈도 유지',
      '💊 혈압 관리 모니터링 병행'
    ]
  },
  6: {  // 최병수
    scores: { happy: 30, calm: 35, sad: 40, anxious: 62, angry: 25, lonely: 45 },
    risk: 'mid',
    riskText: '불안 수치 관찰 필요',
    riskDesc: '불안 지수가 62로 다소 높습니다. 파킨슨 증상 진행에 대한 걱정이 주요 원인으로 보이며, 지속적인 관찰이 필요합니다.',
    recs: [
      '🧘 불안 완화 프로그램 참여',
      '🗣️ 질환 불안에 대한 상담',
      '🎵 음악/미술 치료 활동',
      '📋 증상 변화 기록 및 주치의 공유'
    ]
  }
};
```

---

## 4. 빠른 태그 (quickTags)

```javascript
const quickTags = [
  '😢 눈물을 보이심',
  '🍚 식사를 거르심',
  '😴 수면 어려움 호소',
  '👨‍👩‍👧 가족 이야기',
  '😊 웃으심',
  '🚶 산책을 즐기심',
  '📺 TV 시청에 집중',
  '🗣️ 대화에 적극적',
  '😶 말수가 줄어듦',
  '😠 짜증을 내심'
];
```

---

## 5. 히스토리 데이터 (historyData)

```javascript
const historyData = [
  {
    clientId: 1,
    date: '2/6 09:30',
    mood: 'sad',
    moodFace: '😢',
    moodLabel: '슬픔',
    score: 28,
    note: '자녀 면회 약속이 취소되어 매우 슬퍼하심. 식사도 거르심.',
    dotColor: '#3B82F6'  // blue
  },
  {
    clientId: 4,
    date: '2/5 14:00',
    mood: 'happy',
    moodFace: '😊',
    moodLabel: '기쁨',
    score: 85,
    note: '손주 사진을 보며 즐거워하심. 다른 어르신들과 활발히 대화.',
    dotColor: '#10B981'  // green
  },
  {
    clientId: 2,
    date: '2/5 10:15',
    mood: 'lonely',
    moodFace: '🫤',
    moodLabel: '외로움',
    score: 32,
    note: '혼자 창밖을 바라보시며 말수가 줄어듦. 가족 연락이 없었음.',
    dotColor: '#7C3AED'  // lavender
  },
  {
    clientId: 6,
    date: '2/4 15:30',
    mood: 'anxious',
    moodFace: '😰',
    moodLabel: '불안',
    score: 45,
    note: '손 떨림이 심해졌다며 걱정을 표현하심. 여러 번 확인 행동.',
    dotColor: '#F59E0B'  // amber
  },
  {
    clientId: 3,
    date: '2/4 11:00',
    mood: 'calm',
    moodFace: '😌',
    moodLabel: '평온',
    score: 78,
    note: '원예 활동에 적극 참여. 꽃 이름을 기억하시며 기뻐하심.',
    dotColor: '#0D9488'  // teal
  },
  {
    clientId: 5,
    date: '2/3 09:45',
    mood: 'calm',
    moodFace: '😌',
    moodLabel: '평온',
    score: 72,
    note: '산책 후 기분이 좋아지심. 혈압도 안정적.',
    dotColor: '#0D9488'  // teal
  }
];
```

---

## 6. 주간 추이 차트 데이터

```javascript
const trendData = {
  period: '1/27 ~ 2/2',
  days: ['월', '화', '수', '목', '금', '토', '일'],
  emotions: {
    happy:   [65, 70, 68, 72, 75, 78, 80],
    calm:    [70, 68, 72, 70, 74, 72, 75],
    sad:     [35, 38, 40, 35, 30, 28, 32],
    anxious: [30, 35, 38, 32, 28, 30, 25],
    lonely:  [40, 42, 38, 45, 40, 35, 38]
  },
  colors: {
    happy:   '#10B981',
    calm:    '#0D9488',
    sad:     '#3B82F6',
    anxious: '#F59E0B',
    lonely:  '#7C3AED'
  }
};
```

---

## 7. 핵심 로직

### 7-1. 분석 플로우

```
사용자 동작:
  1. 분석 탭에서 대상자 칩 선택 → selectedClient = id
  2. 관찰 기록 텍스트 입력 (or 빠른 태그 클릭)
  3. "AI 감정 분석 시작" 버튼 클릭

유효성 검증:
  - selectedClient 없으면 → "⚠️ 대상자를 선택해주세요" 토스트
  - observeText 비어있으면 → "⚠️ 관찰 기록을 입력해주세요" 토스트

분석 실행 (startAnalysis):
  1. 분석 버튼 숨김
  2. 인라인 로딩 표시 (전체화면 오버레이)
  3. 4단계 프로그레스 (setTimeout 체인):
     - 100ms: 25% "대화 텍스트 분석 중..."
     - 600ms: 50% "감정 키워드 추출 중..."
     - 1200ms: 75% "심리 패턴 매칭 중..."
     - 1800ms: 100% "종합 평가 생성 중..."
  4. 2400ms: 로딩 제거 → showResult() 호출

결과 표시 (showResult):
  1. sampleResults[selectedClient]에서 데이터 가져오기
  2. 레이더 차트 SVG 동적 생성 (buildRadarSVG)
  3. 바텀시트 HTML 삽입
  4. 오버레이 표시 + 슬라이드업 애니메이션
  5. 300ms 후 레이더 차트 펼침 애니메이션 (animateRadar)
```

### 7-2. 레이더 차트 생성 로직

```javascript
// 6각형 레이더 차트 (SVG 260×260, 중심 130,130, 반경 100)

buildRadarSVG(scores, cx=130, cy=130):
  1. 그리드: 4단계 6각형 (25%, 50%, 75%, 100%)
     - 각도: Math.PI * 2 / 6 * i - Math.PI / 2 (12시 방향 시작)
     - 각 단계: polygon 6개 꼭짓점
  
  2. 축: 중심→꼭짓점 6개 라인
  
  3. 라벨: 반경+20px 위치에 이모지+이름
     점수: 반경+32px 위치에 숫자 (JetBrains Mono)
  
  4. 데이터:
     - 초기: 모든 점이 중심(cx,cy)에 위치 (collapsed)
     - 애니메이션 후: 실제 값 위치로 이동
     - polygon (fill 영역) + circle (각 꼭짓점 dot)
  
  5. 애니메이션:
     - CSS transition: all 1s ease
     - 300ms delay 후 points 속성을 타겟 값으로 변경
     - dot의 cx, cy도 동시 이동

// 좌표 계산
angle = (Math.PI * 2 / 6) * i - Math.PI / 2
x = cx + radius * value/100 * Math.cos(angle)
y = cy + radius * value/100 * Math.sin(angle)
```

### 7-3. 스파크라인 생성

```javascript
// 60×24 SVG polyline
sparkline 배열 (7개 값, 0~100)을 SVG 좌표로 변환:
  x = i * (60 / 6)          // 0, 10, 20, 30, 40, 50, 60
  y = 24 - (value / 100 * 24)  // 값이 높을수록 위로

색상: alert 대상자 → coral, 일반 → teal
```

### 7-4. 탭 전환

```javascript
switchTab(tabId, buttonElement):
  1. 모든 .tab-panel에서 'active' 제거
  2. 모든 .tab-btn에서 'active' 제거
  3. 해당 tab-panel에 'active' 추가
  4. 해당 button에 'active' 추가
  5. tabContent를 상단으로 스크롤

goToAnalysis(clientId):
  1. selectedClient = clientId
  2. switchTab('analysis', ...)
  3. renderClientChips() — 해당 칩 selected 상태로
```

### 7-5. 빠른 태그 → 텍스트 추가

```javascript
addTag(element):
  1. 태그 텍스트에서 앞 이모지 제거 (순수 텍스트만)
  2. observeText에 줄바꿈 + 텍스트 추가
  3. 태그 버튼 스타일 변경 (teal-light 배경, teal 테두리)
```

### 7-6. 위험도 판정 기준

```
risk: 'high'  → 주요 부정감정 점수 65 이상 (슬픔/불안/외로움 중 하나)
risk: 'mid'   → 주요 부정감정 점수 50~64
risk: 'low'   → 주요 부정감정 점수 50 미만, 긍정감정 50 이상

표시:
  high → 🔴 + coral 계열 카드
  mid  → 🟡 + amber 계열 카드
  low  → 🟢 + green 계열 카드
```

---

## 8. Unsplash 이미지 참고

```
홈 히어로:   elderly care, senior care → 따뜻한 돌봄 이미지
분석 히어로: counseling, conversation  → 상담/대화 이미지
추이 히어로: wellness, mental health   → 건강/웰빙 이미지

⚠️ 대상자 아바타는 사진이 아닌 한글 이니셜 아바타 사용
```

---

## 9. 상태 관리

```javascript
// 전역 상태
let selectedClient = null;    // 선택된 대상자 ID (1~6 or null)

// 분석 결과는 sampleResults에서 가져옴 (하드코딩)
// 히스토리도 historyData에서 가져옴 (하드코딩)
// 추후 실제 API 연동 시 상태 관리 라이브러리 도입 가능
```
