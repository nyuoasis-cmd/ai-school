<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>SafeCheck ê±´ì„¤í˜„ì¥ ì•ˆì „ì ê²€</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Archivo+Black&family=JetBrains+Mono:wght@400;500;700&family=Noto+Sans+KR:wght@400;500;700;800;900&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#FFFCF5;--bg2:#FFF7E6;--surface:#FFFFFF;--surface2:#FFF9EE;
  --border:#F0E4CC;--border2:#E6D5AA;
  --text:#2A2010;--text2:#7A6B4E;--text3:#B0A080;
  --amber:#E8960C;--amber-dark:#C47E08;--amber-light:#FFF3D6;--amber-glow:rgba(232,150,12,0.12);
  --green:#1B9E3E;--green-light:#EAFAEF;
  --red:#DC3545;--red-light:#FFF0F0;
  --orange:#E86B0C;--orange-light:#FFF2E6;
  --header-h:52px;--tab-h:56px;
}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
html{height:100%;}
body{
  font-family:'Noto Sans KR',-apple-system,sans-serif;
  background:var(--bg);color:var(--text);
  overflow-x:hidden;min-height:100dvh;
  -webkit-font-smoothing:antialiased;overscroll-behavior-y:contain;
  user-select:none;-webkit-user-select:none;
}
.app-frame{max-width:430px;margin:0 auto;min-height:100dvh;display:flex;flex-direction:column;position:relative;background:var(--bg);}

/* Header */
.app-header{
  height:var(--header-h);display:flex;align-items:center;justify-content:space-between;
  padding:0 14px;background:var(--surface);border-bottom:1.5px solid var(--border);
  position:sticky;top:0;z-index:100;
}
.header-left{display:flex;align-items:center;gap:8px;}
.header-img{width:32px;height:32px;border-radius:8px;object-fit:cover;}
.header-title{font-size:15px;font-weight:800;}
.header-title .hl{color:var(--amber);}

/* Tab bar */
.tab-bar{
  display:flex;background:var(--surface);border-bottom:1.5px solid var(--border);
  position:sticky;top:var(--header-h);z-index:99;
}
.tab-btn{
  flex:1;display:flex;flex-direction:column;align-items:center;gap:2px;
  padding:8px 0 6px;border:none;background:none;cursor:pointer;
  font-family:'Noto Sans KR',sans-serif;font-size:10px;font-weight:500;color:var(--text3);
  transition:color .2s;position:relative;
}
.tab-btn .ti{font-size:20px;}
.tab-btn.active{color:var(--amber);font-weight:800;}
.tab-btn.active::after{content:'';position:absolute;bottom:0;left:20%;right:20%;height:2.5px;background:var(--amber);border-radius:2px;}

/* Content */
.tab-content{flex:1;overflow-y:auto;-webkit-overflow-scrolling:touch;}
.tab-panel{display:none;}.tab-panel.active{display:block;}

/* Hero */
.hero{position:relative;overflow:hidden;background-size:cover;background-position:center;}
.hero-ov{position:absolute;inset:0;background:linear-gradient(180deg,rgba(42,32,16,0.2),rgba(42,32,16,0.75));display:flex;flex-direction:column;justify-content:flex-end;padding:16px;}
.hero h2{font-family:'Archivo Black',sans-serif;font-size:20px;color:#fff;text-shadow:0 1px 4px rgba(0,0,0,.3);}
.hero p{font-size:11px;color:rgba(255,255,255,.8);margin-top:2px;}

/* Section title */
.sec-title{font-size:12px;font-weight:700;color:var(--text2);padding:10px 14px 6px;display:flex;align-items:center;gap:4px;}

/* Zone cards */
.zone-list{padding:0 12px 16px;display:flex;flex-direction:column;gap:8px;}
.zone-card{
  display:flex;overflow:hidden;background:var(--surface);border:1.5px solid var(--border);border-radius:16px;
  cursor:pointer;transition:border-color .2s,box-shadow .2s,transform .15s;
}
.zone-card:active{transform:scale(.98);}
.zone-img{width:100px;height:90px;object-fit:cover;flex-shrink:0;}
.zone-body{flex:1;padding:10px 12px;display:flex;flex-direction:column;justify-content:center;gap:3px;}
.zone-name{font-size:14px;font-weight:800;}
.zone-desc{font-size:10px;color:var(--text3);}
.zone-meta{display:flex;gap:6px;margin-top:2px;}
.zone-badge{font-family:'JetBrains Mono',monospace;font-size:9px;font-weight:600;padding:2px 7px;border-radius:6px;}
.badge-items{background:var(--bg2);color:var(--text2);}
.badge-high{background:var(--red-light);color:var(--red);}
.badge-mid{background:var(--orange-light);color:var(--orange);}

/* ===== WIZARD ===== */
.wizard{display:none;}.wizard.active{display:block;}
.zone-select{}.zone-select.hidden{display:none;}

/* Wizard header image */
.wiz-hero{position:relative;height:110px;background-size:cover;background-position:center;}
.wiz-hero-ov{position:absolute;inset:0;background:linear-gradient(180deg,transparent 30%,rgba(42,32,16,0.7));display:flex;align-items:flex-end;padding:12px 14px;}
.wiz-hero-info{color:#fff;}
.wiz-hero-info h3{font-family:'Archivo Black',sans-serif;font-size:17px;}
.wiz-back{
  position:absolute;top:8px;left:8px;width:34px;height:34px;border-radius:50%;
  background:rgba(0,0,0,.4);backdrop-filter:blur(4px);-webkit-backdrop-filter:blur(4px);
  border:none;color:#fff;font-size:16px;cursor:pointer;display:flex;align-items:center;justify-content:center;
}
.risk-pill{font-size:9px;font-weight:700;padding:2px 8px;border-radius:10px;margin-left:8px;vertical-align:middle;}
.risk-pill.high{background:rgba(220,53,69,.8);color:#fff;}
.risk-pill.mid{background:rgba(232,107,12,.8);color:#fff;}

/* Step progress */
.step-progress{display:flex;align-items:center;justify-content:center;padding:12px 16px 8px;gap:0;}
.step-dot{
  width:26px;height:26px;border-radius:50%;display:flex;align-items:center;justify-content:center;
  font-family:'JetBrains Mono',monospace;font-size:11px;font-weight:700;
  border:2px solid var(--border);background:var(--bg2);color:var(--text3);flex-shrink:0;
  transition:all .3s;
}
.step-dot.active{background:var(--amber);color:#fff;border-color:var(--amber);box-shadow:0 0 0 4px var(--amber-glow);}
.step-dot.done{background:var(--green);color:#fff;border-color:var(--green);}
.step-line{flex:1;height:3px;background:var(--border);margin:0 -1px;transition:background .3s;}
.step-line.done{background:var(--green);}
.step-counter{font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--text3);margin-left:10px;}

/* Category header */
.cat-header{display:flex;align-items:center;gap:10px;padding:8px 14px;}
.cat-img{width:44px;height:44px;border-radius:10px;object-fit:cover;border:2px solid var(--border);}
.cat-info h4{font-size:16px;font-weight:800;}
.cat-info p{font-size:11px;color:var(--text3);}

/* Check items */
.check-list{padding:0 12px 8px;display:flex;flex-direction:column;gap:6px;}
.check-item{
  display:flex;align-items:center;gap:10px;padding:12px 14px;
  background:var(--surface);border:1.5px solid var(--border);border-radius:12px;
  cursor:pointer;transition:all .2s;
}
.check-item.checked{border-color:var(--green);background:var(--green-light);}
.check-item.flagged{border-color:var(--red);background:var(--red-light);}
.check-box{
  width:24px;height:24px;border-radius:6px;border:2px solid var(--border2);
  display:flex;align-items:center;justify-content:center;flex-shrink:0;
  font-size:13px;font-weight:700;color:#fff;transition:all .2s;
}
.check-item.checked .check-box{background:var(--green);border-color:var(--green);}
.check-item.flagged .check-box{background:var(--red);border-color:var(--red);}
.check-text{flex:1;font-size:13px;font-weight:500;transition:color .2s;}
.check-item.checked .check-text{color:var(--green);}
.check-item.flagged .check-text{color:var(--red);}
.flag-btn{
  width:28px;height:28px;display:flex;align-items:center;justify-content:center;
  border:none;background:none;font-size:16px;cursor:pointer;opacity:.3;transition:opacity .2s;
}
.check-item.flagged .flag-btn{opacity:1;}

/* Step nav */
.step-nav{display:flex;gap:8px;padding:10px 12px 16px;}
.step-nav button{
  flex:1;padding:13px;border-radius:14px;border:none;cursor:pointer;
  font-family:'Noto Sans KR',sans-serif;font-size:13px;font-weight:700;transition:transform .1s;
}
.step-nav button:active{transform:scale(.97);}
.btn-prev{background:var(--surface2);color:var(--text2);border:1px solid var(--border);}
.btn-next{background:var(--amber);color:#fff;box-shadow:0 4px 16px var(--amber-glow);}
.btn-finish{background:var(--green);color:#fff;box-shadow:0 4px 16px rgba(27,158,62,.2);}

/* ===== Result Bottom Sheet ===== */
.bs-overlay{
  position:fixed;inset:0;z-index:600;
  background:rgba(42,32,16,.6);backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);
  opacity:0;pointer-events:none;transition:opacity .3s;
}
.bs-overlay.show{opacity:1;pointer-events:auto;}
.bs-sheet{
  position:fixed;left:0;right:0;bottom:0;z-index:601;max-width:430px;margin:0 auto;
  max-height:92vh;background:var(--surface);border-radius:24px 24px 0 0;
  padding:0 0 24px;overflow-y:auto;
  transform:translateY(100%);transition:transform .4s cubic-bezier(.32,.72,0,1);
}
.bs-sheet.show{transform:translateY(0);}
.bs-handle{width:40px;height:4px;background:var(--border);border-radius:4px;margin:10px auto;}

/* Result zone banner */
.res-banner{position:relative;height:100px;background-size:cover;background-position:center;margin-bottom:0;}
.res-banner::after{content:'';position:absolute;inset:0;background:rgba(42,32,16,.55);}
.res-banner-text{position:absolute;inset:0;z-index:1;display:flex;flex-direction:column;align-items:center;justify-content:center;color:#fff;}
.res-banner-text h3{font-family:'Archivo Black',sans-serif;font-size:17px;}
.res-banner-text span{font-size:11px;opacity:.8;margin-top:2px;}

/* Score ring */
.score-area{text-align:center;padding:16px 0 8px;}
.score-ring-wrap{display:inline-block;position:relative;width:130px;height:130px;}
.score-ring-bg{fill:none;stroke:var(--bg2);stroke-width:10;}
.score-ring-fill{fill:none;stroke-width:10;stroke-linecap:round;transition:stroke-dashoffset 1s ease,stroke .5s;}
.score-val{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;}
.score-num{font-family:'Archivo Black',sans-serif;font-size:34px;line-height:1;}
.score-sub{font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--text3);}
.score-grade{font-size:16px;font-weight:800;margin-top:6px;}
.score-comment{font-size:12px;color:var(--text2);margin-top:2px;}

/* Summary cards */
.sum-row{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;padding:12px 16px 0;}
.sum-card{text-align:center;padding:10px 4px;background:var(--bg);border:1px solid var(--border);border-radius:12px;}
.sum-icon{font-size:18px;}
.sum-val{font-family:'JetBrains Mono',monospace;font-size:18px;font-weight:700;margin-top:2px;}
.sum-label{font-size:9px;color:var(--text3);margin-top:1px;}

/* Flagged list */
.flagged-section{margin:12px 16px 0;padding:12px;background:var(--red-light);border:1px solid var(--red);border-radius:14px;}
.flagged-title{font-size:12px;font-weight:700;color:var(--red);margin-bottom:8px;}
.flagged-item{
  display:flex;align-items:center;gap:8px;padding:8px 10px;
  background:rgba(255,255,255,.7);border-radius:8px;margin-bottom:4px;font-size:12px;
}
.flagged-dot{width:8px;height:8px;border-radius:50%;background:var(--red);flex-shrink:0;}
.flagged-cat{font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--text3);margin-left:auto;flex-shrink:0;}

/* Result buttons */
.res-actions{display:flex;gap:8px;padding:14px 16px 0;}
.res-btn{
  flex:1;padding:13px;border-radius:12px;border:none;cursor:pointer;
  font-family:'Noto Sans KR',sans-serif;font-size:13px;font-weight:700;
}
.res-btn.primary{background:var(--amber);color:#fff;}
.res-btn.secondary{background:var(--surface2);color:var(--text2);border:1px solid var(--border);}

/* ===== History Tab ===== */
.hist-section{padding:0 12px 16px;}
.hist-stats{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;padding:10px 12px 4px;}
.hist-stat{text-align:center;background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:8px 0;}
.hist-stat-num{font-family:'JetBrains Mono',monospace;font-size:20px;font-weight:700;line-height:1.2;}
.hist-stat-label{font-size:9px;color:var(--text3);margin-top:1px;}

.hist-list{display:flex;flex-direction:column;gap:8px;padding:0 12px;}
.hist-card{
  display:flex;overflow:hidden;background:var(--surface);border:1.5px solid var(--border);border-radius:14px;
  animation:fadeUp .3s ease both;
}
.hist-img{width:72px;object-fit:cover;flex-shrink:0;}
.hist-body{flex:1;padding:10px 12px;display:flex;flex-direction:column;gap:3px;}
.hist-name{font-size:13px;font-weight:800;}
.hist-date{font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--text3);}
.hist-tags{display:flex;flex-wrap:wrap;gap:4px;margin-top:2px;}
.hist-tag{font-size:9px;font-weight:600;padding:2px 7px;border-radius:6px;}
.hist-score-pill{
  width:42px;display:flex;align-items:center;justify-content:center;flex-shrink:0;
  font-family:'JetBrains Mono',monospace;font-size:13px;font-weight:700;color:#fff;
  border-radius:0 12px 12px 0;
}

/* Empty state */
.empty-state{text-align:center;padding:48px 20px;}
.empty-state .em-icon{font-size:44px;}
.empty-state h3{font-size:15px;font-weight:700;margin-top:10px;color:var(--text2);}
.empty-state p{font-size:12px;color:var(--text3);margin-top:4px;}

/* Toast */
.toast{
  position:fixed;top:80px;left:50%;transform:translateX(-50%) translateY(-20px);
  max-width:340px;padding:10px 18px;border-radius:12px;
  background:var(--surface);color:var(--text);font-size:12px;font-weight:600;
  border:1.5px solid var(--amber);box-shadow:0 8px 32px rgba(42,32,16,.1);
  opacity:0;pointer-events:none;transition:all .3s;z-index:900;
}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0);}

@keyframes fadeUp{from{opacity:0;transform:translateY(12px);}to{opacity:1;transform:translateY(0);}}
</style>
</head>
<body>
<div class="app-frame">

  <!-- Header -->
  <header class="app-header">
    <div class="header-left">
      <img class="header-img" src="https://images.unsplash.com/photo-1541888946425-d81bb19240f5?w=80&h=80&fit=crop" alt="">
      <span class="header-title">Safe<span class="hl">Check</span></span>
    </div>
  </header>

  <!-- Tab Bar -->
  <nav class="tab-bar">
    <button class="tab-btn active" onclick="switchTab('inspect',this)"><span class="ti">âœ…</span>ì ê²€</button>
    <button class="tab-btn" onclick="switchTab('history',this)"><span class="ti">ğŸ“‹</span>ê¸°ë¡</button>
  </nav>

  <!-- Content -->
  <div class="tab-content" id="tabContent">

    <!-- ===== INSPECT TAB ===== -->
    <div class="tab-panel active" id="panel-inspect">

      <!-- Zone Select -->
      <div class="zone-select" id="zoneSelect">
        <div class="hero" style="height:150px;background-image:url('https://images.unsplash.com/photo-1541888946425-d81bb19240f5?w=860&h=360&fit=crop');">
          <div class="hero-ov">
            <h2>ê±´ì„¤í˜„ì¥ ì•ˆì „ì ê²€</h2>
            <p>ì ê²€í•  í˜„ì¥ êµ¬ì—­ì„ ì„ íƒí•˜ì„¸ìš”</p>
          </div>
        </div>
        <div class="sec-title">ğŸ“ ì ê²€ êµ¬ì—­</div>
        <div class="zone-list" id="zoneList"></div>
      </div>

      <!-- Wizard -->
      <div class="wizard" id="wizard">
        <div class="wiz-hero" id="wizHero">
          <div class="wiz-hero-ov">
            <button class="wiz-back" onclick="backToZones()">â†</button>
            <div class="wiz-hero-info" id="wizHeroInfo"></div>
          </div>
        </div>
        <div class="step-progress" id="stepProgress"></div>
        <div class="cat-header" id="catHeader"></div>
        <div class="check-list" id="checkList"></div>
        <div class="step-nav" id="stepNav"></div>
      </div>

    </div>

    <!-- ===== HISTORY TAB ===== -->
    <div class="tab-panel" id="panel-history">
      <div class="hero" style="height:110px;background-image:url('https://images.unsplash.com/photo-1581094794329-c8112a89af12?w=860&h=240&fit=crop');">
        <div class="hero-ov">
          <h2>ì ê²€ ê¸°ë¡</h2>
          <p>ìµœê·¼ ì ê²€ ê²°ê³¼ë¥¼ í™•ì¸í•˜ì„¸ìš”</p>
        </div>
      </div>
      <div class="hist-stats" id="histStats"></div>
      <div class="sec-title">ìµœê·¼ ê¸°ë¡</div>
      <div class="hist-section" id="histSection"></div>
    </div>

  </div>
</div>

<!-- Bottom Sheet -->
<div class="bs-overlay" id="bsOverlay" onclick="closeSheet()"></div>
<div class="bs-sheet" id="bsSheet"></div>

<!-- Toast -->
<div class="toast" id="toast"></div>

<script>
/* ===== DATA ===== */
const zones=[
  {id:'excavation',name:'êµ´ì°© í˜„ì¥',desc:'í† ê³µì‚¬Â·í„°íŒŒê¸° ì‘ì—… êµ¬ì—­',risk:'high',items:16,img:'https://images.unsplash.com/photo-1589939705384-5185137a7f0f?w=400&h=200&fit=crop'},
  {id:'steel',name:'ì² ê³¨ ì‘ì—…',desc:'ì² ê³¨ ì¡°ë¦½Â·ìš©ì ‘ ì‘ì—… êµ¬ì—­',risk:'high',items:14,img:'https://images.unsplash.com/photo-1513467535987-fd81bc7d62f8?w=400&h=200&fit=crop'},
  {id:'scaffold',name:'ë¹„ê³„ ì‘ì—…',desc:'ì™¸ë¶€ ë¹„ê³„ ì„¤ì¹˜Â·í•´ì²´ êµ¬ì—­',risk:'high',items:15,img:'https://images.unsplash.com/photo-1581094794329-c8112a89af12?w=400&h=200&fit=crop'},
  {id:'heights',name:'ê³ ì†Œ ì‘ì—…',desc:'2m ì´ìƒ ë†’ì´ ì‘ì—… êµ¬ì—­',risk:'high',items:14,img:'https://images.unsplash.com/photo-1504307651254-35680f356dfd?w=400&h=200&fit=crop'},
  {id:'electrical',name:'ì „ê¸° ì‘ì—…',desc:'ì „ê¸° ë°°ì„ Â·ë°°ì „ ì‘ì—… êµ¬ì—­',risk:'mid',items:12,img:'https://images.unsplash.com/photo-1621905251189-08b45d6a269e?w=400&h=200&fit=crop'},
  {id:'crane',name:'í¬ë ˆì¸ ì‘ì—…',desc:'ì–‘ì¤‘ê¸°Â·í¬ë ˆì¸ ìš´ë°˜ êµ¬ì—­',risk:'mid',items:13,img:'https://images.unsplash.com/photo-1565008447742-97f6f38c985c?w=400&h=200&fit=crop'}
];

const categories={
  excavation:[
    {name:'ê°œì¸ë³´í˜¸êµ¬',img:'https://images.unsplash.com/photo-1611843467160-25afb8df1074?w=100&h=100&fit=crop',items:['ì•ˆì „ëª¨ ì°©ìš© ì—¬ë¶€','ì•ˆì „í™” ì°©ìš© ìƒíƒœ','ì•ˆì „ì¡°ë¼ ë°˜ì‚¬ ê¸°ëŠ¥ ì •ìƒ','ë³´í˜¸ì•ˆê²½ ì°©ìš© í™•ì¸']},
    {name:'êµ´ì°© ì¥ë¹„',img:'https://images.unsplash.com/photo-1580901368919-7738efb0f87e?w=100&h=100&fit=crop',items:['êµ´ì°©ê¸° ì‘ë™ ì „ ì ê²€ ì™„ë£Œ','í›„ë°© ê²½ê³ ìŒ ì¥ì¹˜ ì •ìƒ','ì¥ë¹„ ì£¼ë³€ ì•ˆì „ê±°ë¦¬ í™•ë³´','ìœ ì•• í˜¸ìŠ¤ ëˆ„ìœ  ì—†ìŒ']},
    {name:'í˜„ì¥ í™˜ê²½',img:'https://images.unsplash.com/photo-1541888946425-d81bb19240f5?w=100&h=100&fit=crop',items:['ì§€ë°˜ ë¶•ê´´ ìœ„í—˜ë„ í™•ì¸','ë°°ìˆ˜ ì‹œì„¤ ì •ìƒ ì‘ë™','ê°€ìŠ¤ ê²€ì§€ ì¸¡ì • ì™„ë£Œ','ì¡°ëª… ë°ê¸° ì ì • (75lux ì´ìƒ)']},
    {name:'ë²•ê·œ ì¤€ìˆ˜',img:'https://images.unsplash.com/photo-1450101499163-c8848c66ca85?w=100&h=100&fit=crop',items:['ì‘ì—… í—ˆê°€ì„œ ë¹„ì¹˜ í™•ì¸','ì•ˆì „ê´€ë¦¬ì í˜„ì¥ ë°°ì¹˜','ë¹„ìƒì—°ë½ë§ ê²Œì‹œ í™•ì¸','ì•ˆì „êµìœ¡ ì´ìˆ˜ í™•ì¸']}
  ],
  steel:[
    {name:'ê°œì¸ë³´í˜¸êµ¬',img:'https://images.unsplash.com/photo-1611843467160-25afb8df1074?w=100&h=100&fit=crop',items:['ì•ˆì „ëª¨ í„±ëˆ ì²´ê²° í™•ì¸','ì•ˆì „ëŒ€ ì°©ìš© ë° ê±¸ì´ í™•ì¸','ì•ˆì „í™” ìƒíƒœ ì ê²€','ìš©ì ‘ ë³´í˜¸ë©´ êµ¬ë¹„']},
    {name:'ì² ê³¨ ì¥ë¹„',img:'https://images.unsplash.com/photo-1567361808960-dec9cb578182?w=100&h=100&fit=crop',items:['ë³¼íŠ¸Â·ë„ˆíŠ¸ ì²´ê²° ìƒíƒœ','ìš©ì ‘ ì¥ë¹„ ì ˆì—° í™•ì¸','ì™€ì´ì–´ë¡œí”„ ë§ˆëª¨ë„ ì ê²€','ê³ ë ¥ë³¼íŠ¸ í† í¬ í™•ì¸']},
    {name:'ì‘ì—… í™˜ê²½',img:'https://images.unsplash.com/photo-1504307651254-35680f356dfd?w=100&h=100&fit=crop',items:['ì¶”ë½ë°©ì§€ë§ ì„¤ì¹˜ í™•ì¸','ì•ˆì „ë‚œê°„ ì„¤ì¹˜ ìƒíƒœ','ì‘ì—… ë°œíŒ ê³ ì • í™•ì¸']},
    {name:'ë²•ê·œ ì¤€ìˆ˜',img:'https://images.unsplash.com/photo-1450101499163-c8848c66ca85?w=100&h=100&fit=crop',items:['ì‘ì—…ê³„íšì„œ ë¹„ì¹˜ í™•ì¸','ìœ ìê²©ì ë°°ì¹˜ í™•ì¸','ì•ˆì „êµìœ¡ ì‹¤ì‹œ í™•ì¸']}
  ],
  scaffold:[
    {name:'ê°œì¸ë³´í˜¸êµ¬',img:'https://images.unsplash.com/photo-1611843467160-25afb8df1074?w=100&h=100&fit=crop',items:['ì•ˆì „ëª¨ ì°©ìš© í™•ì¸','ì•ˆì „ëŒ€ ì´ì¤‘ ê±¸ì´ í™•ì¸','ë¯¸ë„ëŸ¼ ë°©ì§€ ì•ˆì „í™”','ì•ˆì „ì¥ê°‘ ì°©ìš©']},
    {name:'ë¹„ê³„ êµ¬ì¡°',img:'https://images.unsplash.com/photo-1581094794329-c8112a89af12?w=100&h=100&fit=crop',items:['ìˆ˜ì§Â·ìˆ˜í‰ ì—°ê²° ìƒíƒœ','ë²½ì´ìŒ ê°„ê²© ê·œì • ì¤€ìˆ˜','ì‘ì—… ë°œíŒ í­ 40cm ì´ìƒ','ë°œíŒ í‹ˆìƒˆ 3cm ì´í•˜']},
    {name:'ì•ˆì „ ì‹œì„¤',img:'https://images.unsplash.com/photo-1541888946425-d81bb19240f5?w=100&h=100&fit=crop',items:['ì•ˆì „ë‚œê°„ ë†’ì´ 90cm ì´ìƒ','ì¤‘ê°„ë‚œê°„ ì„¤ì¹˜ í™•ì¸','ë°œëë§‰ì´íŒ ì„¤ì¹˜','ìŠ¹ê°• ì‚¬ë‹¤ë¦¬ ê³ ì •']},
    {name:'ì ê²€ ê¸°ì¤€',img:'https://images.unsplash.com/photo-1454165804606-c3d57bc86b40?w=100&h=100&fit=crop',items:['ì¡°ë¦½ë„ í˜„ì¥ ë¹„ì¹˜','ìì¬ ì ì¬ í•˜ì¤‘ ì¤€ìˆ˜','ì•…ì²œí›„ ì‘ì—…ì¤‘ì§€ ê¸°ì¤€ ê²Œì‹œ']}
  ],
  heights:[
    {name:'ê°œì¸ë³´í˜¸êµ¬',img:'https://images.unsplash.com/photo-1611843467160-25afb8df1074?w=100&h=100&fit=crop',items:['ì „ì‹  ì•ˆì „ëŒ€ ì°©ìš©','ëœì•¼ë“œ ì†ìƒ ì—¬ë¶€','ì•ˆì „ëª¨ í„±ëˆ ì²´ê²°','ì•ˆì „í™” ë¯¸ë„ëŸ¼ ë°©ì§€']},
    {name:'ì¶”ë½ ë°©ì§€',img:'https://images.unsplash.com/photo-1504307651254-35680f356dfd?w=100&h=100&fit=crop',items:['ì•ˆì „ë‚œê°„ ì„¤ì¹˜ í™•ì¸','ì¶”ë½ë°©ì§€ë§ ì„¤ì¹˜','ê°œêµ¬ë¶€ ë®ê°œ ì„¤ì¹˜','ìˆ˜ì§ ë³´í˜¸ë§ ì„¤ì¹˜']},
    {name:'ì‘ì—… í™˜ê²½',img:'https://images.unsplash.com/photo-1504307651254-35680f356dfd?w=100&h=100&fit=crop',items:['í’ì† 10m/s ì´í•˜ í™•ì¸','ë¹„Â·ëˆˆ ë“± ê¸°ìƒ í™•ì¸','ì‘ì—… ë°œíŒ ìƒíƒœ ì–‘í˜¸']},
    {name:'ë²•ê·œ ì¤€ìˆ˜',img:'https://images.unsplash.com/photo-1450101499163-c8848c66ca85?w=100&h=100&fit=crop',items:['2m ì´ìƒ ì‘ì—… í—ˆê°€ í™•ì¸','ì•ˆì „ê´€ë¦¬ì ì…íšŒ','ë¹„ìƒ êµ¬ì¡° ê³„íš ìˆ˜ë¦½']}
  ],
  electrical:[
    {name:'ê°œì¸ë³´í˜¸êµ¬',img:'https://images.unsplash.com/photo-1611843467160-25afb8df1074?w=100&h=100&fit=crop',items:['ì ˆì—°ì¥ê°‘ ì°©ìš© í™•ì¸','ì ˆì—° ì•ˆì „í™” ìƒíƒœ','ì ˆì—° ë³´í˜¸êµ¬ êµ¬ë¹„']},
    {name:'ì „ê¸° ì•ˆì „',img:'https://images.unsplash.com/photo-1621905251189-08b45d6a269e?w=100&h=100&fit=crop',items:['ì „ì› ì°¨ë‹¨ í™•ì¸ (LOTO)','ê²€ì „ê¸° ì‘ë™ ì‹œí—˜','ì ‘ì§€ ìƒíƒœ í™•ì¸','ì ˆì—°ì €í•­ ì¸¡ì • ì™„ë£Œ']},
    {name:'ì‘ì—… í™˜ê²½',img:'https://images.unsplash.com/photo-1504307651254-35680f356dfd?w=100&h=100&fit=crop',items:['ìŠµê¸° ì œê±° í™•ì¸','ì¶©ì „ë¶€ ë°©í˜¸ ì¡°ì¹˜','ê°ì „ ê²½ê³  í‘œì§€ ì„¤ì¹˜']},
    {name:'ë²•ê·œ ì¤€ìˆ˜',img:'https://images.unsplash.com/photo-1450101499163-c8848c66ca85?w=100&h=100&fit=crop',items:['ì „ê¸°ì‘ì—… í—ˆê°€ì„œ í™•ì¸','ìœ ìê²©ì ì‘ì—… í™•ì¸']}
  ],
  crane:[
    {name:'ê°œì¸ë³´í˜¸êµ¬',img:'https://images.unsplash.com/photo-1611843467160-25afb8df1074?w=100&h=100&fit=crop',items:['ì•ˆì „ëª¨ ì°©ìš© í™•ì¸','ì•ˆì „ì¡°ë¼ ì°©ìš©','ì‹ í˜¸ìˆ˜ ë°°ì¹˜ í™•ì¸']},
    {name:'í¬ë ˆì¸ ì ê²€',img:'https://images.unsplash.com/photo-1565008447742-97f6f38c985c?w=100&h=100&fit=crop',items:['ì™€ì´ì–´ë¡œí”„ ë§ˆëª¨ë„','ê³¼ë¶€í•˜ ë°©ì§€ì¥ì¹˜ ì •ìƒ','ê¶Œê³¼ ë°©ì§€ì¥ì¹˜ ì‘ë™','ë¸Œë ˆì´í¬ ì‘ë™ í™•ì¸']},
    {name:'ì‘ì—… ë°˜ê²½',img:'https://images.unsplash.com/photo-1517089596392-fb9a9033e05b?w=100&h=100&fit=crop',items:['ì¸ì–‘ í•˜ì¤‘í‘œ ë¹„ì¹˜','ì‘ì—… ë°˜ê²½ ë‚´ í†µì œ','ì§€ë°˜ ì§€ì§€ë ¥ í™•ì¸','ì•„ì›ƒë¦¬ê±° ì„¤ì¹˜ í™•ì¸']},
    {name:'ë²•ê·œ ì¤€ìˆ˜',img:'https://images.unsplash.com/photo-1450101499163-c8848c66ca85?w=100&h=100&fit=crop',items:['í¬ë ˆì¸ ê²€ì‚¬ì¦ ë¹„ì¹˜','ìš´ì „ì› ìê²© í™•ì¸']}
  ]
};

/* ===== STATE ===== */
let currentZone=null, currentStep=0, checkStates={};
const STORAGE_KEY='safecheck_history';

function getHistory(){try{return JSON.parse(sessionStorage.getItem(STORAGE_KEY))||[];}catch{return[];}}
function setHistory(h){try{sessionStorage.setItem(STORAGE_KEY,JSON.stringify(h));}catch{}}

/* ===== INIT ===== */
document.addEventListener('DOMContentLoaded',()=>{renderZones();renderHistoryTab();});

/* ===== RENDER ZONES ===== */
function renderZones(){
  document.getElementById('zoneList').innerHTML=zones.map(z=>`
    <div class="zone-card" onclick="selectZone('${z.id}')">
      <img class="zone-img" src="${z.img}" alt="${z.name}">
      <div class="zone-body">
        <div class="zone-name">${z.name}</div>
        <div class="zone-desc">${z.desc}</div>
        <div class="zone-meta">
          <span class="zone-badge badge-items">${z.items}ê°œ í•­ëª©</span>
          <span class="zone-badge ${z.risk==='high'?'badge-high':'badge-mid'}">${z.risk==='high'?'âš  ê³ ìœ„í—˜':'âš  ì¤‘ìœ„í—˜'}</span>
        </div>
      </div>
    </div>`).join('');
}

/* ===== SELECT ZONE â†’ START WIZARD ===== */
function selectZone(id){
  currentZone=id; currentStep=0; checkStates={};
  document.getElementById('zoneSelect').classList.add('hidden');
  document.getElementById('wizard').classList.add('active');
  renderWizard();
}

function backToZones(){
  document.getElementById('wizard').classList.remove('active');
  document.getElementById('zoneSelect').classList.remove('hidden');
  currentZone=null;
}

/* ===== RENDER WIZARD ===== */
function renderWizard(){
  const z=zones.find(x=>x.id===currentZone);
  const cats=categories[currentZone];
  const cat=cats[currentStep];
  const totalSteps=cats.length;

  // Hero
  document.getElementById('wizHero').style.backgroundImage=`url('${z.img}')`;
  document.getElementById('wizHeroInfo').innerHTML=`<h3>${z.name}<span class="risk-pill ${z.risk}">${z.risk==='high'?'ê³ ìœ„í—˜':'ì¤‘ìœ„í—˜'}</span></h3>`;

  // Step progress
  let progHTML='';
  for(let i=0;i<totalSteps;i++){
    const cls=i<currentStep?'done':i===currentStep?'active':'';
    const label=i<currentStep?'âœ“':(i+1);
    progHTML+=`<div class="step-dot ${cls}">${label}</div>`;
    if(i<totalSteps-1){
      progHTML+=`<div class="step-line ${i<currentStep?'done':''}"></div>`;
    }
  }
  progHTML+=`<span class="step-counter">${currentStep+1} / ${totalSteps} ë‹¨ê³„</span>`;
  document.getElementById('stepProgress').innerHTML=progHTML;

  // Category header
  document.getElementById('catHeader').innerHTML=`
    <img class="cat-img" src="${cat.img}" alt="">
    <div class="cat-info"><h4>${cat.name}</h4><p>íƒ­: âœ… ì í•© Â· ğŸš© ìœ„ë°˜</p></div>`;

  // Check items
  document.getElementById('checkList').innerHTML=cat.items.map((item,idx)=>{
    const key=`${currentStep}-${idx}`;
    const st=checkStates[key]||'';
    const boxIcon=st==='checked'?'âœ“':st==='flagged'?'!':'';
    return `<div class="check-item ${st}" onclick="toggleCheck('${key}')">
      <div class="check-box">${boxIcon}</div>
      <span class="check-text">${item}</span>
      <button class="flag-btn" onclick="event.stopPropagation();toggleFlag('${key}')">ğŸš©</button>
    </div>`;
  }).join('');

  // Step nav
  let navHTML='';
  if(currentStep===0){
    navHTML=`<button class="btn-prev" onclick="backToZones()">â† êµ¬ì—­ ì„ íƒ</button>`;
  } else {
    navHTML=`<button class="btn-prev" onclick="prevStep()">â† ì´ì „</button>`;
  }
  if(currentStep<totalSteps-1){
    navHTML+=`<button class="btn-next" onclick="nextStep()">ë‹¤ìŒ â†’</button>`;
  } else {
    navHTML+=`<button class="btn-finish" onclick="finishInspection()">ğŸ ì ê²€ ì™„ë£Œ</button>`;
  }
  document.getElementById('stepNav').innerHTML=navHTML;
}

/* ===== CHECK/FLAG TOGGLE ===== */
function toggleCheck(key){
  checkStates[key]=checkStates[key]==='checked'?undefined:'checked';
  renderWizard();
}
function toggleFlag(key){
  checkStates[key]=checkStates[key]==='flagged'?undefined:'flagged';
  renderWizard();
}

/* ===== STEP NAV ===== */
function prevStep(){if(currentStep>0){currentStep--;renderWizard();}}
function nextStep(){const cats=categories[currentZone];if(currentStep<cats.length-1){currentStep++;renderWizard();}}

/* ===== SCORING ===== */
function calculateScore(){
  const cats=categories[currentZone];
  let total=0,checked=0,flagged=0,unchecked=0;
  const flaggedItems=[];
  cats.forEach((cat,ci)=>{
    cat.items.forEach((item,ii)=>{
      total++;
      const st=checkStates[`${ci}-${ii}`];
      if(st==='checked') checked++;
      else if(st==='flagged'){flagged++;flaggedItems.push({text:item,cat:cat.name});}
      else unchecked++;
    });
  });
  const base=Math.round(checked/total*100);
  const fp=Math.round(flagged/total*40);
  const up=Math.round(unchecked/total*10);
  const score=Math.max(0,Math.min(100,base-fp-up));
  return{score,checked,flagged,unchecked,total,flaggedItems};
}

/* ===== FINISH â†’ RESULT BOTTOM SHEET ===== */
function finishInspection(){
  const z=zones.find(x=>x.id===currentZone);
  const r=calculateScore();
  const color=r.score>=80?'var(--green)':r.score>=50?'var(--amber)':'var(--red)';
  const grade=r.score>=80?'ğŸŸ¢ ì•ˆì „':r.score>=50?'ğŸŸ¡ ì£¼ì˜':'ğŸ”´ ìœ„í—˜';
  const comment=r.score>=80?'í˜„ì¥ ì•ˆì „ ìƒíƒœê°€ ì–‘í˜¸í•©ë‹ˆë‹¤':r.score>=50?'ì¼ë¶€ í•­ëª©ì˜ ê°œì„ ì´ í•„ìš”í•©ë‹ˆë‹¤':'ì¦‰ì‹œ ì‘ì—… ì¤‘ì§€ ë° ì‹œì • ì¡°ì¹˜ê°€ í•„ìš”í•©ë‹ˆë‹¤';
  const circ=377;
  const offset=circ-(r.score/100)*circ;

  let flagHTML='';
  if(r.flaggedItems.length>0){
    flagHTML=`<div class="flagged-section"><div class="flagged-title">ğŸš¨ ìœ„ë°˜ ì‚¬í•­ (${r.flaggedItems.length}ê±´)</div>${r.flaggedItems.map(f=>`<div class="flagged-item"><div class="flagged-dot"></div><span>${f.text}</span><span class="flagged-cat">${f.cat}</span></div>`).join('')}</div>`;
  }

  document.getElementById('bsSheet').innerHTML=`
    <div class="bs-handle"></div>
    <div class="res-banner" style="background-image:url('${z.img}')">
      <div class="res-banner-text"><h3>${z.name}</h3><span>${z.risk==='high'?'ê³ ìœ„í—˜':'ì¤‘ìœ„í—˜'} êµ¬ì—­ ì ê²€ ê²°ê³¼</span></div>
    </div>
    <div class="score-area">
      <div class="score-ring-wrap">
        <svg width="130" height="130" viewBox="0 0 130 130">
          <circle class="score-ring-bg" cx="65" cy="65" r="55"/>
          <circle class="score-ring-fill" id="scoreRing" cx="65" cy="65" r="55"
            stroke="${color}" stroke-dasharray="${circ}" stroke-dashoffset="${circ}"
            transform="rotate(-90 65 65)"/>
        </svg>
        <div class="score-val">
          <span class="score-num" style="color:${color}">${r.score}</span>
          <span class="score-sub">/ 100</span>
        </div>
      </div>
      <div class="score-grade" style="color:${color}">${grade}</div>
      <div class="score-comment">${comment}</div>
    </div>
    <div class="sum-row">
      <div class="sum-card"><div class="sum-icon">âœ…</div><div class="sum-val" style="color:var(--green)">${r.checked}</div><div class="sum-label">ì í•©</div></div>
      <div class="sum-card"><div class="sum-icon">ğŸš©</div><div class="sum-val" style="color:var(--red)">${r.flagged}</div><div class="sum-label">ìœ„ë°˜</div></div>
      <div class="sum-card"><div class="sum-icon">â¬œ</div><div class="sum-val" style="color:var(--text3)">${r.unchecked}</div><div class="sum-label">ë¯¸ì ê²€</div></div>
    </div>
    ${flagHTML}
    <div class="res-actions">
      <button class="res-btn primary" onclick="saveRecord()">ğŸ“‹ ê¸°ë¡ ì €ì¥</button>
      <button class="res-btn secondary" onclick="resetInspection()">ë‹¤ì‹œ ì ê²€</button>
    </div>`;

  // Show sheet
  document.getElementById('bsOverlay').classList.add('show');
  requestAnimationFrame(()=>{document.getElementById('bsSheet').classList.add('show');});
  // Animate ring
  setTimeout(()=>{
    const ring=document.getElementById('scoreRing');
    if(ring){ring.style.strokeDashoffset=offset;ring.style.transition='stroke-dashoffset 1s ease';}
  },350);
  // Store result for saving
  window._lastResult=r;
}

/* ===== SAVE RECORD ===== */
function saveRecord(){
  const z=zones.find(x=>x.id===currentZone);
  const r=window._lastResult;
  if(!r)return;
  const now=new Date();
  const record={
    zone:currentZone,score:r.score,checked:r.checked,flagged:r.flagged,
    unchecked:r.unchecked,total:r.total,flaggedItems:r.flaggedItems,
    date:now.toISOString()
  };
  const h=[record,...getHistory()].slice(0,10);
  setHistory(h);
  showToast('âœ… ì ê²€ ê¸°ë¡ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤');
  setTimeout(()=>{closeSheet();resetInspection();renderHistoryTab();},500);
}

/* ===== RESET ===== */
function resetInspection(){
  closeSheet();
  backToZones();
}

/* ===== CLOSE SHEET ===== */
function closeSheet(){
  document.getElementById('bsSheet').classList.remove('show');
  document.getElementById('bsOverlay').classList.remove('show');
}

/* ===== TAB SWITCH ===== */
function switchTab(id,btn){
  document.querySelectorAll('.tab-panel').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
  document.getElementById('panel-'+id).classList.add('active');
  btn.classList.add('active');
  if(id==='history') renderHistoryTab();
}

/* ===== RENDER HISTORY TAB ===== */
function renderHistoryTab(){
  const h=getHistory();
  const safe=h.filter(r=>r.score>=80).length;
  const totalFlags=h.reduce((s,r)=>s+r.flagged,0);

  document.getElementById('histStats').innerHTML=`
    <div class="hist-stat"><div class="hist-stat-num" style="color:var(--amber)">${h.length}</div><div class="hist-stat-label">ì´ ì ê²€</div></div>
    <div class="hist-stat"><div class="hist-stat-num" style="color:var(--green)">${safe}</div><div class="hist-stat-label">ì•ˆì „ í†µê³¼</div></div>
    <div class="hist-stat"><div class="hist-stat-num" style="color:var(--red)">${totalFlags}</div><div class="hist-stat-label">ìœ„ë°˜ ë°œê²¬</div></div>`;

  if(h.length===0){
    document.getElementById('histSection').innerHTML=`
      <div class="empty-state"><div class="em-icon">ğŸ—ï¸</div><h3>ì ê²€ ê¸°ë¡ì´ ì—†ì–´ìš”</h3><p>ì ê²€ íƒ­ì—ì„œ êµ¬ì—­ì„ ì„ íƒí•˜ê³  ì ê²€ì„ ì‹œì‘í•˜ì„¸ìš”</p></div>`;
    return;
  }

  document.getElementById('histSection').innerHTML=`<div class="hist-list">${h.map((rec,i)=>{
    const z=zones.find(x=>x.id===rec.zone);
    if(!z) return '';
    const d=new Date(rec.date);
    const ds=`${d.getMonth()+1}/${d.getDate()} ${String(d.getHours()).padStart(2,'0')}:${String(d.getMinutes()).padStart(2,'0')}`;
    const gc=rec.score>=80?'var(--green)':rec.score>=50?'var(--amber)':'var(--red)';
    const gl=rec.score>=80?'ì•ˆì „':rec.score>=50?'ì£¼ì˜':'ìœ„í—˜';
    const glc=rec.score>=80?'background:var(--green-light);color:var(--green)':rec.score>=50?'background:var(--amber-light);color:var(--amber)':'background:var(--red-light);color:var(--red)';
    return `<div class="hist-card" style="animation-delay:${i*.05}s">
      <img class="hist-img" src="${z.img}" alt="">
      <div class="hist-body">
        <div class="hist-name">${z.name}</div>
        <div class="hist-date">${ds}</div>
        <div class="hist-tags">
          <span class="hist-tag" style="${glc}">${gl}</span>
          ${rec.flagged>0?`<span class="hist-tag" style="background:var(--red-light);color:var(--red)">ğŸš© ${rec.flagged}ê±´</span>`:''}
          <span class="hist-tag" style="background:var(--bg2);color:var(--text2)">âœ… ${rec.checked}/${rec.total}</span>
        </div>
      </div>
      <div class="hist-score-pill" style="background:${gc}">${rec.score}</div>
    </div>`;
  }).join('')}</div>`;
}

/* ===== TOAST ===== */
function showToast(msg){
  const t=document.getElementById('toast');
  t.textContent=msg;t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'),2500);
}
</script>
</body>
</html>